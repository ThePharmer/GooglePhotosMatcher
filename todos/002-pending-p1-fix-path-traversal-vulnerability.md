---
id: 002
priority: p1
status: pending
category: security
created: 2025-11-22
effort: medium
agents: security-sentinel
---

# Fix Path Traversal Vulnerability via JSON Title Field

## Problem Statement

The `title` field from JSON files is used directly in file path construction without proper validation. The `fixTitle()` function does NOT remove path traversal sequences (`..`) or forward slashes (`/`).

A malicious JSON with `"title": "../../../etc/passwd"` could write files outside the intended directory.

## Affected Files

- `/home/user/GooglePhotosMatcher/files/main.py` (lines 37, 47, 84-85)
- `/home/user/GooglePhotosMatcher/files/auxFunctions.py` (lines 55-58)

## Proposed Solution

1. Update `fixTitle()` to use `os.path.basename()` to strip path components:

```python
def fixTitle(title):
    import os
    # Get only the basename, removing any path components
    title = os.path.basename(str(title))
    # Remove dangerous characters
    dangerous_chars = ['%', '<', '>', '=', ':', '?', 'Â¿', '*', '#', '&',
                       '{', '}', '\\', '@', '!', '+', '|', '"', "'", '\x00']
    for char in dangerous_chars:
        title = title.replace(char, "")
    return title
```

2. Add path validation helper:

```python
def safe_join(base_path, filename):
    full_path = os.path.normpath(os.path.join(base_path, filename))
    if not full_path.startswith(os.path.normpath(base_path) + os.sep):
        raise ValueError("Path traversal attempt detected")
    return full_path
```

## Impact

- Arbitrary file write/overwrite outside working directory
- Potential system file corruption
- Security breach (OWASP A01:2021 - Broken Access Control)

## Acceptance Criteria

- [ ] `fixTitle()` removes all path components using `os.path.basename()`
- [ ] Path traversal sequences (`..`, `/`) are neutralized
- [ ] All file operations use validated paths
- [ ] Unit tests cover path traversal attempts
